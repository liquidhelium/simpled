var L=Object.defineProperty;var q=(t,e,n)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(q(t,typeof e!="symbol"?e+"":e,n),n);const C=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};C();var M=(t=>(t[t.Linear=0]="Linear",t[t.Const=1]="Const",t[t.SineOut=2]="SineOut",t[t.SineIn=3]="SineIn",t[t.QuadOut=4]="QuadOut",t[t.QuadIn=5]="QuadIn",t))(M||{});function N(t,e,n,r,i,o){var s;return s=O(t,e,n,r,i,m[o]),s}function O(t,e,n,r,i,o){return o((i-t)/(e-t))*(r-n)+n}const m=[t=>t,t=>1,t=>Math.sin(t*Math.PI/2),t=>1-Math.cos(t*Math.PI/2),t=>1-(t-1)**2,t=>t**2,t=>(1-Math.cos(t*Math.PI))/2,t=>((t*=2)<1?t**2:-((t-2)**2-2))/2,t=>1+(t-1)**3,t=>t**3,t=>1-(t-1)**4,t=>t**4,t=>((t*=2)<1?t**3:(t-2)**3+2)/2,t=>((t*=2)<1?t**4:-((t-2)**4-2))/2,t=>1+(t-1)**5,t=>t**5,t=>1-2**(-10*t),t=>2**(10*(t-1)),t=>Math.sqrt(1-(t-1)**2),t=>1-Math.sqrt(1-t**2),t=>(2.70158*t-1)*(t-1)**2+1,t=>(2.70158*t-1.70158)*t**2,t=>((t*=2)<1?1-Math.sqrt(1-t**2):Math.sqrt(1-(t-2)**2)+1)/2,t=>t<.5?(14.379638*t-5.189819)*t**2:(14.379638*t-9.189819)*(t-1)**2+1,t=>1-2**(-10*t)*Math.cos(t*Math.PI/.15),t=>2**(10*(t-1))*Math.cos((t-1)*Math.PI/.15),t=>((t*=11)<4?t**2:t<8?(t-6)**2+12:t<10?(t-9)**2+15:(t-10.5)**2+15.75)/16,t=>1-m[26](1-t),t=>(t*=2)<1?m[26](t)/2:m[27](t-1)/2+.5,t=>t<.5?2**(20*t-11)*Math.sin((160*t+1)*Math.PI/18):1-2**(9-20*t)*Math.sin((160*t+1)*Math.PI/18)];class g{constructor(e=0,n=0,r=0,i=0,o=M.Const){a(this,"start_time");a(this,"end_time");a(this,"start_value");a(this,"end_value");a(this,"ease_type");this.start_time=e,this.end_time=n,this.start_value=r,this.end_value=i,this.ease_type=o}get_at(e){return N(this.start_time,this.end_time,this.start_value,this.end_value,e,this.ease_type)}}function w(t,e,n=0,r=t.length){if(n>r)return-1;let i=Math.floor((r+n)/2);return t[i].start_time<=e&&t[i].end_time>=e?i:t[i].start_time>e?(r=i-1,w(t,e,n,r)):(n=i+1,w(t,e,n,r))}function h(t,e){var n=t[w(t,e)].get_at(e);return n}var v=(t=>(t[t.Invalid=0]="Invalid",t[t.Tap=1]="Tap",t))(v||{});class j{constructor(e=0,n=0){a(this,"time");a(this,"judge_type");a(this,"judged",!1);this.time=e,this.judge_type=n}}class I{constructor(e=-1,n=-1,r=[new g]){a(this,"from");a(this,"to");a(this,"alpha");this.from=e,this.to=n,this.alpha=r}}class P{constructor(e=0,n=[new g],r=[new g],i=[new j]){a(this,"id");a(this,"x_position");a(this,"y_position");a(this,"judgements");a(this,"cached_x",0);a(this,"cached_y",0);this.id=e,this.x_position=n,this.y_position=r,this.judgements=i}}class F{constructor(e=[new P],n=[new I],r){a(this,"description");a(this,"connections");a(this,"dots");this.dots=e,this.connections=n,this.description=r}}function b(t){try{var e=JSON.parse(t)}catch(n){throw console.error("unable to load chart"),n}return T(e)}function y(t){return new g(t.start_time,t.end_time,t.start_value,t.end_value,t.ease_type)}function D(t){return new j(t.time,t.judge_type)}function f(t,e){var n=[];for(let r of t)n.push(e(r));return n}function k(t){return new I(t.from,t.to,f(t.alpha,y))}function E(t){return new P(t.id,f(t.x_position,y),f(t.y_position,y),f(t.judgements,D))}function T(t){return new F(f(t.dots,E),f(t.connections,k),t.description)}function A(t,e,n){var r=e.getContext("2d");r.lineWidth=5,r.lineCap="round";for(let d of t.connections){var i,o,s,_;t.dots[d.from].cached_x=i=h(t.dots[d.from].x_position,n),t.dots[d.to].cached_x=o=h(t.dots[d.to].x_position,n),t.dots[d.from].cached_y=s=h(t.dots[d.from].y_position,n),t.dots[d.to].cached_y=_=h(t.dots[d.to].y_position,n),i*=e.width,o*=e.width,s*=e.height,_*=e.height;var B=h(d.alpha,n);r.strokeStyle="rgba(10,10,10,"+(B/255).toString()+")",r.beginPath(),r.moveTo(i,s),r.lineTo(o,_),r.stroke()}}function G(t){var e=t.getContext("2d");if(!e)throw Error("no context");e.fillStyle="#FEFEFE",e.beginPath(),e.fillRect(0,0,t.width,t.height),e.closePath()}function H(t,e){var n=e.getContext("2d");if(!n)throw Error("no context");n.font="50px arial",n.textAlign="center",n.textBaseline="middle";for(const i of t.values()){n.fillStyle="#00000099",n.beginPath(),n.arc(i.x*e.width,i.y*e.height,50,0,2*Math.PI),n.fill();var r=i.id.toString();n.fillText(r,i.x*e.width,i.y*e.height,45)}}class Q{constructor(e,n,r){a(this,"x");a(this,"y");a(this,"press_time");a(this,"id");a(this,"tap_judged",!1);a(this,"in_judge",!1);this.x=e,this.y=n,this.id=r,this.press_time=new Date().getTime()*.001}}var u=new Map;function W(t){t.ontouchstart=e=>{e.preventDefault();for(let i=0;i<e.touches.length;i++){const o=e.touches[i];var n=(o.pageX-t.offsetLeft)/t.offsetWidth,r=(o.pageY-t.offsetTop)/t.offsetHeight;u.set(o.identifier,new Q(n,r,o.identifier))}},t.ontouchmove=e=>{e.preventDefault();for(let i=0;i<e.touches.length;i++){const o=e.touches[i];var n=(o.pageX-t.offsetLeft)/t.offsetWidth,r=(o.pageY-t.offsetTop)/t.offsetHeight;u.get(o.identifier).x=n,u.get(o.identifier).y=r}},t.ontouchend=e=>{e.preventDefault();for(let n=0;n<e.changedTouches.length;n++){const r=e.changedTouches[n].identifier;u.delete(r)}},t.ontouchcancel=e=>{e.preventDefault();for(let n=0;n<e.changedTouches.length;n++){const r=e.changedTouches[n].identifier;u.delete(r)}}}const l={Perfect:50,Good:100,Bad:150},X=.07;function Y(t){for(const e of t.dots)for(const n of u.values())if(z(e,n))for(const r of e.judgements)r.judged||console.log(K(r,n))}function K(t,e){var n;switch(t.judge_type){case v.Invalid:throw Error("judgement type is invalid");case v.Tap:n=U(t,e),e.tap_judged=!0;break}return n!=c.None&&(t.judged=!0),et(n),n}function z(t,e){var n=Math.sqrt((t.cached_x-e.x)**2+(t.cached_y-e.y)**2);return n<X}function U(t,e){if(e.tap_judged)return c.None;var n=(t.time-e.press_time+globalThis.chart_start*.001)*1e3;return console.log(n),tt(n),n<l.Perfect&&n>-l.Perfect?c.Perfect:n<l.Good&&n>-l.Good?c.Good:n<l.Bad&&n>-l.Bad?c.Bad:c.None}var c=(t=>(t[t.Perfect=0]="Perfect",t[t.Good=1]="Good",t[t.Bad=2]="Bad",t[t.None=3]="None",t))(c||{}),x=0,V=window.matchMedia("(orientation: portrait)");window.onload=()=>{let t="chart2.json",e=new XMLHttpRequest;e.open("get",t,!0),e.responseType="blob",e.onload=function(){if(this.status==200){var n=new FileReader;n.onload=r=>{var i=n.result,o=b(i),s=document.getElementById("draw_area");p(s),R(),V.addEventListener("change",_=>{p(s)}),S(o,s)},n.readAsText(e.response)}},e.send()};function Z(){var t=document.getElementById("draw_area");t.requestFullscreen(),p(t)}function p(t){var e=t.offsetWidth,n=t.offsetHeight,r=devicePixelRatio;t.width=Math.max(e,n)*r,t.height=Math.min(e,n)*r}function S(t,e,n=0){var r=i=>{var o=new Date().getTime(),s=(o-n)*.001;G(e),A(t,e,s),H(u,e),Y(t),x=requestAnimationFrame(r)};n+=new Date().getTime(),globalThis.chart_start=n,console.log("start timing."),x=requestAnimationFrame(r)}function $(){cancelAnimationFrame(x)}function R(){var t=document.getElementById("full_screen"),e=document.getElementById("upload_file"),n=document.getElementById("draw_area");if(!(t&&e))throw new Error("querying err.");t.onclick=Z,e.onchange=async r=>{var i=e.files?e.files[0]:null;!i||J(i)},W(n)}async function J(t){var e=await t.text();try{var n=b(e)}catch(i){console.warn(i);return}$();var r=document.getElementById("draw_area");S(n,r)}function tt(t){var e=document.getElementById("judge_adjust");e.innerHTML=t.toString()}function et(t){var e=document.getElementById("judge_result");e.innerHTML=c[t]}
